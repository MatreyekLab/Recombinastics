geom_vline(xintercept  = f132_control_95pct_interval, linetype = 2)
f132_fraction_unexcised <- sum((f132_subset %>% filter(sample == "Flanked"))$ratio > f132_control_95pct_interval[1])/nrow((f132_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F132", "frac_unexcised" = f132_fraction_unexcised))
## f280
f280_g718a <- read.csv(file = "data/flow/Flanking/F280_G718A unselected.csv.gz") %>% mutate("flow" = "F280", sample = "Flanked")
f280_g747a <- read.csv(file = "data/flow/Flanking/F280_G747A_unselected.csv.gz") %>% mutate("flow" = "F280", sample = "Control")
flank_expt_cell_num <- 180000
flank_red_pos_cutoff <- 3e3
f280 <- rbind(f280_g718a[1:flank_expt_cell_num,], f280_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f280, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f280$ratio <- f280$BL1.A / f280$YL2.A
f280_subset <- f280 %>% filter(YL2.A >= flank_red_pos_cutoff)
f280_control_95pct_interval <- c(quantile((f280_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f280_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f280_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f280_control_95pct_interval, linetype = 2)
f280_fraction_unexcised <- sum((f280_subset %>% filter(sample == "Flanked"))$ratio > f280_control_95pct_interval[1])/nrow((f280_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F280", "frac_unexcised" = f280_fraction_unexcised))
## f281
f281_g718a <- read.csv(file = "data/flow/Flanking/F281_G718A unselected.csv.gz") %>% mutate("flow" = "F281", sample = "Flanked")
f281_g747a <- read.csv(file = "data/flow/Flanking/F281_G747A unselected.csv.gz") %>% mutate("flow" = "F281", sample = "Control")
flank_expt_cell_num <- 310000
flank_red_pos_cutoff <- 3e3
f281 <- rbind(f281_g718a[1:flank_expt_cell_num,], f281_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f281, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f281$ratio <- f281$BL1.A / f281$YL2.A
f281_subset <- f281 %>% filter(YL2.A >= flank_red_pos_cutoff)
f281_control_95pct_interval <- c(quantile((f281_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f281_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f281_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f281_control_95pct_interval, linetype = 2)
f281_fraction_unexcised <- sum((f281_subset %>% filter(sample == "Flanked"))$ratio > f281_control_95pct_interval[1])/nrow((f281_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F281", "frac_unexcised" = f281_fraction_unexcised))
## f282
f282_g718a <- read.csv(file = "data/flow/Flanking/F282_G718A unselected.csv.gz") %>% mutate("flow" = "F282", sample = "Flanked")
f282_g747a <- read.csv(file = "data/flow/Flanking/F282_G747A unselected.csv.gz") %>% mutate("flow" = "F282", sample = "Control")
flank_expt_cell_num <- 280000
flank_red_pos_cutoff <- 3e3
f282 <- rbind(f282_g718a[1:flank_expt_cell_num,], f282_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f282, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f282$ratio <- f282$BL1.A / f282$YL2.A
f282_subset <- f282 %>% filter(YL2.A >= flank_red_pos_cutoff)
f282_control_95pct_interval <- c(quantile((f282_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f282_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f282_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f282_control_95pct_interval, linetype = 2)
f282_fraction_unexcised <- sum((f282_subset %>% filter(sample == "Flanked"))$ratio > f282_control_95pct_interval[1])/nrow((f282_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F282", "frac_unexcised" = f282_fraction_unexcised))
## Some summary graphs
## An example set of samples
f131_example <- rbind(f131_none[1:20000,], f131_g718a[1:20000,], f131_g747a[1:20000,]) %>% filter(!is.na(sample))
f131_example$sample <- factor(f131_example$sample, levels = c("None", "Flanked", "Control"))
F131_example_scatterplot <- ggplot() + theme(panel.grid.minor = element_blank()) +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0), breaks = c(1e2,1e4)) +
scale_y_log10(limits = c(1e1,1e4), expand = c(0,0), breaks = c(1e2,1e3)) +
geom_point(data = f131_example, aes(x = YL2.A, y = BL1.A), alpha = 0.1, size = 0.5) +
facet_grid(cols = vars(sample))
ggsave(file = "plots/Flanking_example_scatterplot.pdf", F131_example_scatterplot, height = 1.6, width = 4.5)
F131_example_scatterplot
## Looking at fraction excised over time
flanking_flow_days <- read.csv(file = "data/Flanking_expt_timepoints.csv", header = T, stringsAsFactors = F)
flanking_flow_df2 <- merge(flanking_flow_df, flanking_flow_days, by = "flow")
Flanking_timeplot <- ggplot() + theme(panel.grid.minor = element_blank()) +
scale_y_log10(limits = c(0.001,1)) + scale_x_log10() +
labs(x = "Days after\ntransfection", y = "Fraction of\ncells unexcised") +
geom_point(data = flanking_flow_df2 %>% filter(instrument == "Attune"), aes(x = days, y = frac_unexcised))
ggsave(file = "plots/Flanking_timeplot.pdf", Flanking_timeplot, height = 1.6, width = 2)
Flanking_timeplot
## Looking at the reproducibility of recombination
flank_indep_recombs <- flanking_flow_df2 %>% group_by(replicate) %>% summarize(frac_unexcised = 10^mean(log10(frac_unexcised)))
flank_flow_geomean <- 10^mean(log10(flank_indep_recombs$frac_unexcised))
flank_flow_upper_conf <- 10^(mean(log10(flank_indep_recombs$frac_unexcised)) + (sd(log10(flank_indep_recombs$frac_unexcised))/sqrt(nrow(flank_indep_recombs)) * 1.96))
flank_flow_lower_conf <- 10^(mean(log10(flank_indep_recombs$frac_unexcised)) - (sd(log10(flank_indep_recombs$frac_unexcised))/sqrt(nrow(flank_indep_recombs)) * 1.96))
Repeated_excisions_plot <- ggplot() + theme(panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
labs(x = NULL, y = "Fraction of cells unexcised") +
scale_y_log10(limits = c(0.001,1)) + #scale_x_continuous(limits = c(-0.1,0.1)) +
geom_point(data = flank_indep_recombs, aes(x = 0, y = frac_unexcised), alpha = 0.5) +
geom_point(aes(x = 0, y = flank_flow_geomean), shape = 95, size = 10) +
geom_errorbar(aes(x = 0, ymax = flank_flow_upper_conf, ymin = flank_flow_lower_conf), width = 0.01)
ggsave(file = "plots/Repeated_excisions_plot.pdf", Repeated_excisions_plot, height = 1.1, width = 1)
Repeated_excisions_plot
Flanking_timeplot <- ggplot() + theme(panel.grid.minor = element_blank()) +
scale_y_log10(limits = c(0.001,1)) + scale_x_log10() +
labs(x = "Days after\ntransfection", y = "Fraction of\ncells unexcised") +
geom_point(data = flanking_flow_df2 %>% filter(instrument == "Attune"), aes(x = days, y = frac_unexcised, color = replicate))
ggsave(file = "plots/Flanking_timeplot.pdf", Flanking_timeplot, height = 1.6, width = 2)
Flanking_timeplot
flanking_flow_df2$replicate <- as.factor(flanking_flow_df2$replicate)
Flanking_timeplot <- ggplot() + theme(panel.grid.minor = element_blank()) +
scale_y_log10(limits = c(0.001,1)) + scale_x_log10() +
labs(x = "Days after\ntransfection", y = "Fraction of\ncells unexcised") +
geom_point(data = flanking_flow_df2 %>% filter(instrument == "Attune"), aes(x = days, y = frac_unexcised, color = replicate))
ggsave(file = "plots/Flanking_timeplot.pdf", Flanking_timeplot, height = 1.6, width = 2)
Flanking_timeplot
## f281b
f281b_g718a <- read.csv(file = "data/flow/Flanking/F281b_G718A unselected.csv.gz") %>% mutate("flow" = "F281b", sample = "Flanked")
flank_expt_cell_num <- 230000
flank_red_pos_cutoff <- 3e3
f281b <- rbind(f281b_g718a[1:flank_expt_cell_num,], f281_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f281b, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f281b$ratio <- f281b$BL1.A / f281b$YL2.A
f281b_subset <- f281b %>% filter(YL2.A >= flank_red_pos_cutoff)
f281b_control_95pct_interval <- c(quantile((f281b_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f281b_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f281b_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f281b_control_95pct_interval, linetype = 2)
f281b_fraction_unexcised <- sum((f281b_subset %>% filter(sample == "Flanked"))$ratio > f281b_control_95pct_interval[1])/nrow((f281b_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F281b", "frac_unexcised" = f281b_fraction_unexcised))
## f282b
f282b_g718a <- read.csv(file = "data/flow/Flanking/F282B_G718A unselected.csv.gz") %>% mutate("flow" = "F282b", sample = "Flanked")
flank_expt_cell_num <- 930000
flank_red_pos_cutoff <- 3e3
## f282b
f282b_g718a <- read.csv(file = "data/flow/Flanking/F282B_G718A unselected.csv.gz") %>% mutate("flow" = "F282b", sample = "Flanked")
flank_expt_cell_num <- 930000
flank_red_pos_cutoff <- 3e3
f282b <- rbind(f282b_g718a[1:flank_expt_cell_num,], f282_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f282b, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f282b$ratio <- f282b$BL1.A / f282b$YL2.A
f282b_subset <- f282b %>% filter(YL2.A >= flank_red_pos_cutoff)
f282b_control_95pct_interval <- c(quantile((f282b_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f282b_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f282b_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f282b_control_95pct_interval, linetype = 2)
f282b_fraction_unexcised <- sum((f282b_subset %>% filter(sample == "Flanked"))$ratio > f282b_control_95pct_interval[1])/nrow((f282b_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F282b", "frac_unexcised" = f282b_fraction_unexcised))
View(flanking_flow_df)
## f282b
f282b_g718a <- read.csv(file = "data/flow/Flanking/F282b_G718A unselected.csv.gz") %>% mutate("flow" = "F282b", sample = "Flanked")
flank_expt_cell_num <- 930000
flank_red_pos_cutoff <- 3e3
f282b <- rbind(f282b_g718a[1:flank_expt_cell_num,], f282_g747a[1:flank_expt_cell_num,])
f282b <- rbind(f282b_g718a[1:flank_expt_cell_num,], f282_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f282b, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f282b$ratio <- f282b$BL1.A / f282b$YL2.A
f282b_subset <- f282b %>% filter(YL2.A >= flank_red_pos_cutoff)
f282b_control_95pct_interval <- c(quantile((f282b_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f282b_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f282b_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f282b_control_95pct_interval, linetype = 2)
f282b_fraction_unexcised <- sum((f282b_subset %>% filter(sample == "Flanked"))$ratio > f282b_control_95pct_interval[1])/nrow((f282b_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F282b", "frac_unexcised" = f282b_fraction_unexcised))
## Making a data frame to keep track of how many unexcised cells are observed with G718A
flanking_flow_df <- data.frame("flow" = NA, "frac_unexcised" = NA)
flank_red_pos_cutoff <- 3e3
## F46 LSR2
f46_g718a <- read.csv(file = "data/flow/Flanking/LSR2/F46_G718A_029_Singlets.csv.gz") %>% mutate("flow" = "F46", sample = "Flanked")
f46_g747a <- read.csv(file = "data/flow/Flanking/LSR2/F46_G747A_030_Singlets.csv.gz") %>% mutate("flow" = "F46", sample = "Control")
flank_expt_cell_num <- 12000
flank_red_pos_cutoff <- 1e4
f46 <- rbind(f46_g718a[1:flank_expt_cell_num,], f46_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f46, aes(x = YG610.A, y = B525.A), alpha = 0.01) +
facet_grid(rows = vars(sample))
f46$ratio <- f46$B525.A / f46$YG610.A
f46_subset <- f46 %>% filter(YG610.A >= flank_red_pos_cutoff)
f46_control_95pct_interval <- c(quantile((f46_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f46_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f46_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f46_control_95pct_interval, linetype = 2)
f46_fraction_unexcised <- sum((f46_subset %>% filter(sample == "Flanked"))$ratio > f46_control_95pct_interval[1])/nrow((f46_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F46", "frac_unexcised" = f46_fraction_unexcised))
## F84
f84_none <- read.csv(file = "data/flow/Flanking/F84_None_Sample(1)_Singlets.csv.gz") %>% mutate("flow" = "F84", sample = "None")
f84_g718a <- read.csv(file = "data/flow/Flanking/F84_G718A_Sample(4)_Singlets.csv.gz") %>% mutate("flow" = "F84", sample = "Flanked")
f84_g747a <- read.csv(file = "data/flow/Flanking/F84_G747A_Sample(5)_Singlets.csv.gz") %>% mutate("flow" = "F84", sample = "Control")
flank_expt_cell_num <- 90000
flank_red_pos_cutoff <- 5e3
f84 <- rbind(f84_none[1:flank_expt_cell_num,], f84_g718a[1:flank_expt_cell_num,], f84_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f84, aes(x = YL2.A, y = BL1.A), alpha = 0.01) +
facet_grid(rows = vars(sample))
f84$ratio <- f84$BL1.A / f84$YL2.A
f84_subset <- f84 %>% filter(YL2.A >= flank_red_pos_cutoff)
f84_control_95pct_interval <- c(quantile((f84_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f84_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f84_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f84_control_95pct_interval, linetype = 2)
f84_fraction_unexcised <- sum((f84_subset %>% filter(sample == "Flanked"))$ratio > f84_control_95pct_interval[1])/nrow((f84_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F84", "frac_unexcised" = f84_fraction_unexcised))
## F101 Aria
f101_none <- read.csv(file = "data/flow/Flanking/Aria/F101_None_001_Singlets.csv.gz") %>% mutate("flow" = "F101", sample = "None")
f101_g718a <- read.csv(file = "data/flow/Flanking/Aria/F101_G718A_002_Singlets.csv.gz") %>% mutate("flow" = "F101", sample = "Flanked")
f101_g747a <- read.csv(file = "data/flow/Flanking/Aria/F101_G747A_003_Singlets.csv.gz") %>% mutate("flow" = "F101", sample = "Control")
flank_expt_cell_num <- 2400
flank_red_pos_cutoff <- 5e3
f101 <- rbind(f101_none[1:flank_expt_cell_num,], f101_g718a[1:flank_expt_cell_num,], f101_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f101, aes(x = G610.A, y = B515.A), alpha = 0.01) +
facet_grid(rows = vars(sample))
f101$ratio <- f101$B515.A / f101$G610.A
f101_subset <- f101 %>% filter(G610.A >= flank_red_pos_cutoff)
f101_control_95pct_interval <- c(quantile((f101_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f101_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f101_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f101_control_95pct_interval, linetype = 2)
f101_fraction_unexcised <- sum((f101_subset %>% filter(sample == "Flanked"))$ratio > f101_control_95pct_interval[1])/nrow((f101_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F101", "frac_unexcised" = f101_fraction_unexcised))
## F114
f114_g718a <- read.csv(file = "data/flow/Flanking/F114_G718A_A2_Single Cells.csv.gz") %>% mutate("flow" = "F114", sample = "Flanked")
f114_g747a <- read.csv(file = "data/flow/Flanking/F114_G747A_A3_Single Cells.csv.gz") %>% mutate("flow" = "F114", sample = "Control")
flank_expt_cell_num <- 45000
flank_red_pos_cutoff <- 3e3
f114 <- rbind(f114_g718a[1:flank_expt_cell_num,], f114_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f114, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f114$ratio <- f114$BL1.A / f114$YL2.A
f114_subset <- f114 %>% filter(YL2.A >= flank_red_pos_cutoff)
f114_control_95pct_interval <- c(quantile((f114_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f114_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f114_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f114_control_95pct_interval, linetype = 2)
f114_fraction_unexcised <- sum((f114_subset %>% filter(sample == "Flanked"))$ratio > f114_control_95pct_interval[1])/nrow((f114_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F114", "frac_unexcised" = f114_fraction_unexcised))
## F116
f116_g718a <- read.csv(file = "data/flow/Flanking/F116_G718A_H11_Singlets.csv.gz") %>% mutate("flow" = "F116", sample = "Flanked")
f116_g747a <- read.csv(file = "data/flow/Flanking/F116_G747A_H12_Singlets.csv.gz") %>% mutate("flow" = "F116", sample = "Control")
flank_expt_cell_num <- 25000
flank_red_pos_cutoff <- 5e3
f116 <- rbind(f116_g718a[1:flank_expt_cell_num,], f116_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f116, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f116$ratio <- f116$BL1.A / f116$YL2.A
f116_subset <- f116 %>% filter(YL2.A >= flank_red_pos_cutoff)
f116_control_95pct_interval <- c(quantile((f116_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f116_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f116_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f116_control_95pct_interval, linetype = 2)
f116_fraction_unexcised <- sum((f116_subset %>% filter(sample == "Flanked"))$ratio > f116_control_95pct_interval[1])/nrow((f116_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F116", "frac_unexcised" = f116_fraction_unexcised))
## F119
f119_none <- read.csv(file = "data/flow/Flanking/F119_None_G11_Singlets.csv.gz") %>% mutate("flow" = "F119", sample = "None")
f119_g718a <- read.csv(file = "data/flow/Flanking/F119_G718A_H11_Singlets.csv.gz") %>% mutate("flow" = "F119", sample = "Flanked")
f119_g747a <- read.csv(file = "data/flow/Flanking/F119_G747A_H12_Singlets.csv.gz") %>% mutate("flow" = "F119", sample = "Control")
flank_expt_cell_num <- 9000
flank_red_pos_cutoff <- 5e3
f119 <- rbind(f119_none[1:flank_expt_cell_num,], f119_g718a[1:flank_expt_cell_num,], f119_g747a[1:flank_expt_cell_num,]) %>% filter(!is.na(sample))
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f119, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f119$ratio <- f119$BL1.A / f119$YL2.A
f119_subset <- f119 %>% filter(YL2.A >= flank_red_pos_cutoff)
f119_control_95pct_interval <- c(quantile((f119_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f119_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f119_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f119_control_95pct_interval, linetype = 2)
f119_fraction_unexcised <- sum((f119_subset %>% filter(sample == "Flanked"))$ratio > f119_control_95pct_interval[1])/nrow((f119_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F119", "frac_unexcised" = f119_fraction_unexcised))
## F130
f130_none <- read.csv(file = "data/flow/Flanking/F130_none_D10_Singlets.csv.gz") %>% mutate("flow" = "F130", sample = "None")
f130_g718a <- read.csv(file = "data/flow/Flanking/F130_G718A_D11_Singlets.csv.gz") %>% mutate("flow" = "F130", sample = "Flanked")
f130_g747a <- read.csv(file = "data/flow/Flanking/F130_G747A_D12_Singlets.csv.gz") %>% mutate("flow" = "F130", sample = "Control")
flank_expt_cell_num <- 89000
flank_red_pos_cutoff <- 5e3
f130 <- rbind(f130_none[1:flank_expt_cell_num,], f130_g718a[1:flank_expt_cell_num,], f130_g747a[1:flank_expt_cell_num,]) %>% filter(!is.na(sample))
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f130, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f130$ratio <- f130$BL1.A / f130$YL2.A
f130_subset <- f130 %>% filter(YL2.A >= flank_red_pos_cutoff)
f130_control_95pct_interval <- c(quantile((f130_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f130_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f130_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f130_control_95pct_interval, linetype = 2)
f130_fraction_unexcised <- sum((f130_subset %>% filter(sample == "Flanked"))$ratio > f130_control_95pct_interval[1])/nrow((f130_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F130", "frac_unexcised" = f130_fraction_unexcised))
## F131
f131_none <- read.csv(file = "data/flow/Flanking/F131_none_D4_Singlets.csv.gz") %>% mutate("flow" = "F131", sample = "None")
f131_g718a <- read.csv(file = "data/flow/Flanking/F131_G718A_D5_Singlets.csv.gz") %>% mutate("flow" = "F131", sample = "Flanked")
f131_g747a <- read.csv(file = "data/flow/Flanking/F131_G747A_D6_Singlets.csv.gz") %>% mutate("flow" = "F131", sample = "Control")
flank_expt_cell_num <- 190000
flank_red_pos_cutoff <- 3e3
f131 <- rbind(f131_none[1:flank_expt_cell_num,], f131_g718a[1:flank_expt_cell_num,], f131_g747a[1:flank_expt_cell_num,]) %>% filter(!is.na(sample))
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f131, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f131$ratio <- f131$BL1.A / f131$YL2.A
f131_subset <- f131 %>% filter(YL2.A >= flank_red_pos_cutoff)
f131_control_95pct_interval <- c(quantile((f131_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f131_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f131_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f131_control_95pct_interval, linetype = 2)
f131_fraction_unexcised <- sum((f131_subset %>% filter(sample == "Flanked"))$ratio > f131_control_95pct_interval[1])/nrow((f131_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F131", "frac_unexcised" = f131_fraction_unexcised))
## F132
f132_g718a <- read.csv(file = "data/flow/Flanking/F132_G718A_G12_Singlets.csv.gz") %>% mutate("flow" = "F132", sample = "Flanked")
f132_g747a <- read.csv(file = "data/flow/Flanking/F132_G747A_H1_Singlets.csv.gz") %>% mutate("flow" = "F132", sample = "Control")
flank_expt_cell_num <- 180000
flank_red_pos_cutoff <- 3e3
f132 <- rbind(f132_g718a[1:flank_expt_cell_num,], f132_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f132, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f132$ratio <- f132$BL1.A / f132$YL2.A
f132_subset <- f132 %>% filter(YL2.A >= flank_red_pos_cutoff)
f132_control_95pct_interval <- c(quantile((f132_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f132_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f132_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f132_control_95pct_interval, linetype = 2)
f132_fraction_unexcised <- sum((f132_subset %>% filter(sample == "Flanked"))$ratio > f132_control_95pct_interval[1])/nrow((f132_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F132", "frac_unexcised" = f132_fraction_unexcised))
## f280
f280_g718a <- read.csv(file = "data/flow/Flanking/F280_G718A unselected.csv.gz") %>% mutate("flow" = "F280", sample = "Flanked")
f280_g747a <- read.csv(file = "data/flow/Flanking/F280_G747A_unselected.csv.gz") %>% mutate("flow" = "F280", sample = "Control")
flank_expt_cell_num <- 180000
flank_red_pos_cutoff <- 3e3
f280 <- rbind(f280_g718a[1:flank_expt_cell_num,], f280_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f280, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f280$ratio <- f280$BL1.A / f280$YL2.A
f280_subset <- f280 %>% filter(YL2.A >= flank_red_pos_cutoff)
f280_control_95pct_interval <- c(quantile((f280_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f280_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f280_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f280_control_95pct_interval, linetype = 2)
f280_fraction_unexcised <- sum((f280_subset %>% filter(sample == "Flanked"))$ratio > f280_control_95pct_interval[1])/nrow((f280_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F280", "frac_unexcised" = f280_fraction_unexcised))
## f281
f281_g718a <- read.csv(file = "data/flow/Flanking/F281_G718A unselected.csv.gz") %>% mutate("flow" = "F281", sample = "Flanked")
f281_g747a <- read.csv(file = "data/flow/Flanking/F281_G747A unselected.csv.gz") %>% mutate("flow" = "F281", sample = "Control")
flank_expt_cell_num <- 310000
flank_red_pos_cutoff <- 3e3
f281 <- rbind(f281_g718a[1:flank_expt_cell_num,], f281_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f281, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f281$ratio <- f281$BL1.A / f281$YL2.A
f281_subset <- f281 %>% filter(YL2.A >= flank_red_pos_cutoff)
f281_control_95pct_interval <- c(quantile((f281_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f281_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f281_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f281_control_95pct_interval, linetype = 2)
f281_fraction_unexcised <- sum((f281_subset %>% filter(sample == "Flanked"))$ratio > f281_control_95pct_interval[1])/nrow((f281_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F281", "frac_unexcised" = f281_fraction_unexcised))
## f281b
f281b_g718a <- read.csv(file = "data/flow/Flanking/F281b_G718A unselected.csv.gz") %>% mutate("flow" = "F281b", sample = "Flanked")
flank_expt_cell_num <- 230000
flank_red_pos_cutoff <- 3e3
f281b <- rbind(f281b_g718a[1:flank_expt_cell_num,], f281_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f281b, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f281b$ratio <- f281b$BL1.A / f281b$YL2.A
f281b_subset <- f281b %>% filter(YL2.A >= flank_red_pos_cutoff)
f281b_control_95pct_interval <- c(quantile((f281b_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f281b_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f281b_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f281b_control_95pct_interval, linetype = 2)
f281b_fraction_unexcised <- sum((f281b_subset %>% filter(sample == "Flanked"))$ratio > f281b_control_95pct_interval[1])/nrow((f281b_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F281b", "frac_unexcised" = f281b_fraction_unexcised))
## f282
f282_g718a <- read.csv(file = "data/flow/Flanking/F282_G718A unselected.csv.gz") %>% mutate("flow" = "F282", sample = "Flanked")
f282_g747a <- read.csv(file = "data/flow/Flanking/F282_G747A unselected.csv.gz") %>% mutate("flow" = "F282", sample = "Control")
flank_expt_cell_num <- 280000
flank_red_pos_cutoff <- 3e3
f282 <- rbind(f282_g718a[1:flank_expt_cell_num,], f282_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f282, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f282$ratio <- f282$BL1.A / f282$YL2.A
f282_subset <- f282 %>% filter(YL2.A >= flank_red_pos_cutoff)
f282_control_95pct_interval <- c(quantile((f282_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f282_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f282_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f282_control_95pct_interval, linetype = 2)
f282_fraction_unexcised <- sum((f282_subset %>% filter(sample == "Flanked"))$ratio > f282_control_95pct_interval[1])/nrow((f282_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F282", "frac_unexcised" = f282_fraction_unexcised))
## f282b
f282b_g718a <- read.csv(file = "data/flow/Flanking/F282b_G718A unselected.csv.gz") %>% mutate("flow" = "F282b", sample = "Flanked")
flank_expt_cell_num <- 930000
flank_red_pos_cutoff <- 3e3
f282b <- rbind(f282b_g718a[1:flank_expt_cell_num,], f282_g747a[1:flank_expt_cell_num,])
ggplot() + theme_bw() +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0)) +
scale_y_log10(limits = c(1e1,1e5), expand = c(0,0)) +
geom_vline(xintercept = flank_red_pos_cutoff, linetype = 2) +
geom_point(data = f282b, aes(x = YL2.A, y = BL1.A), alpha = 0.1) +
facet_grid(rows = vars(sample))
f282b$ratio <- f282b$BL1.A / f282b$YL2.A
f282b_subset <- f282b %>% filter(YL2.A >= flank_red_pos_cutoff)
f282b_control_95pct_interval <- c(quantile((f282b_subset %>% filter(sample == "Control"))$ratio,0.05),quantile((f282b_subset %>% filter(sample == "Control"))$ratio,0.975))
ggplot() + theme_bw() + scale_x_continuous(limits = c(-0.05, 0.5)) +
geom_histogram(data = f282b_subset, aes(x = ratio), binwidth = 0.01) +
facet_grid(rows = vars(sample)) +
geom_vline(xintercept  = f282b_control_95pct_interval, linetype = 2)
f282b_fraction_unexcised <- sum((f282b_subset %>% filter(sample == "Flanked"))$ratio > f282b_control_95pct_interval[1])/nrow((f282b_subset %>% filter(sample == "Flanked")))
flanking_flow_df <- rbind(flanking_flow_df, data.frame("flow" = "F282b", "frac_unexcised" = f282b_fraction_unexcised))
## Some summary graphs
## An example set of samples
f131_example <- rbind(f131_none[1:20000,], f131_g718a[1:20000,], f131_g747a[1:20000,]) %>% filter(!is.na(sample))
f131_example$sample <- factor(f131_example$sample, levels = c("None", "Flanked", "Control"))
F131_example_scatterplot <- ggplot() + theme(panel.grid.minor = element_blank()) +
scale_x_log10(limits = c(1e1,1e5), expand = c(0,0), breaks = c(1e2,1e4)) +
scale_y_log10(limits = c(1e1,1e4), expand = c(0,0), breaks = c(1e2,1e3)) +
geom_point(data = f131_example, aes(x = YL2.A, y = BL1.A), alpha = 0.1, size = 0.5) +
facet_grid(cols = vars(sample))
ggsave(file = "plots/Flanking_example_scatterplot.pdf", F131_example_scatterplot, height = 1.6, width = 4.5)
F131_example_scatterplot
## Looking at fraction excised over time
flanking_flow_days <- read.csv(file = "data/Flanking_expt_timepoints.csv", header = T, stringsAsFactors = F)
flanking_flow_df2 <- merge(flanking_flow_df, flanking_flow_days, by = "flow")
flanking_flow_df2$replicate <- as.factor(flanking_flow_df2$replicate)
Flanking_timeplot <- ggplot() + theme(panel.grid.minor = element_blank()) +
scale_y_log10(limits = c(0.001,1)) + scale_x_log10() +
labs(x = "Days after\ntransfection", y = "Fraction of\ncells unexcised") +
geom_point(data = flanking_flow_df2 %>% filter(instrument == "Attune"), aes(x = days, y = frac_unexcised, color = replicate))
ggsave(file = "plots/Flanking_timeplot.pdf", Flanking_timeplot, height = 1.6, width = 2)
Flanking_timeplot
## Looking at the reproducibility of recombination
flank_indep_recombs <- flanking_flow_df2 %>% group_by(replicate) %>% summarize(frac_unexcised = 10^mean(log10(frac_unexcised)))
flank_flow_geomean <- 10^mean(log10(flank_indep_recombs$frac_unexcised))
flank_flow_upper_conf <- 10^(mean(log10(flank_indep_recombs$frac_unexcised)) + (sd(log10(flank_indep_recombs$frac_unexcised))/sqrt(nrow(flank_indep_recombs)) * 1.96))
flank_flow_lower_conf <- 10^(mean(log10(flank_indep_recombs$frac_unexcised)) - (sd(log10(flank_indep_recombs$frac_unexcised))/sqrt(nrow(flank_indep_recombs)) * 1.96))
Repeated_excisions_plot <- ggplot() + theme(panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
labs(x = NULL, y = "Fraction of cells unexcised") +
scale_y_log10(limits = c(0.001,1)) + #scale_x_continuous(limits = c(-0.1,0.1)) +
geom_point(data = flank_indep_recombs, aes(x = 0, y = frac_unexcised), alpha = 0.5) +
geom_point(aes(x = 0, y = flank_flow_geomean), shape = 95, size = 10) +
geom_errorbar(aes(x = 0, ymax = flank_flow_upper_conf, ymin = flank_flow_lower_conf), width = 0.01)
ggsave(file = "plots/Repeated_excisions_plot.pdf", Repeated_excisions_plot, height = 1.1, width = 1)
Repeated_excisions_plot
